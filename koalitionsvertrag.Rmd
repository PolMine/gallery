---
title: "Wissenschaftliches Programmieren mit R"
subtitle: "Der Koalitionsvertrag 2021 als Wortwolke"
author: "Andreas Blaette"
date: "26. November 2021"
output: 
  xaringan::moon_reader:
    css: ["./css/default.css", "./css/metropolis.css", "./css/robot-fonts.css", './css/polminify.css']
    nature:
      countIncrementalSlides: false
editor_options:
  chunk_output_type: console
---


# Laden von Bibliotheken

Unser Ziel ist, den Ampel-Koalitionsvertrag in die Form einer Wortwolke zu gießen. Wie machen wir das?

Wir brauchen dafür ein paar Bibliotheken ... 

```{r, warning = TRUE, message = FALSE}
library(pdftools)
library(tokenizers)
library(dplyr)
library(data.table)
library(wordcloud2)
```

... und holen uns den Koalitionsvertrag aus dem Netz.

```{r}
url <- "https://www.spd.de/fileadmin/Dokumente/Koalitionsvertrag/Koalitionsvertrag_2021-2025.pdf"
local <- tempfile()
download.file(url = url, destfile = local)
```

Diesen haben wir jetzt lokal in einer temporären Datei.

---

# Stopwords

Weil wir wählerisch sind, definieren wir Stopwörter, die uns nicht interessieren. 

```{r}
drop <- c(
  tm::stopwords("de"),
  paste(
    toupper(substr(tm::stopwords("de"), 1, 1)), 
    substr(tm::stopwords("de"), 2, nchar(tm::stopwords("de"))),
    sep = ""
  )
)
```

Es macht es etwas komplizierter,  ist aber für die deutsche Sprache adäquat: Wir machen hier nicht die Groß- und Kleinschreibung platt. Wer entziffert wie der Code das macht?

---

# Text befreien - Tokenisieren - Zählen

Wir befreien den Text aus dem pdf-Dokument, zerlegen den in Wörter und werfen dabei die Stopwörter weg. Daraus machen wir dann eine Tabelle...

```{r}
txt <- pdftools::pdf_text(local) %>%
  tokenizers::tokenize_words(lowercase = FALSE, stopwords = drop) %>%
  unlist() %>%
  data.table(word = .)
```

Das mag man mir verzeihen: Ich bin ein Freund der `data.table`-Tabellen. Wir zählen jetzt und bringen die Tabelle in eine gut verdaubare Form.

```{r}
cnt <- txt[, .N, by = "word"]
setorderv(cnt, cols = "N", order = -1L)
setnames(cnt, old = "N", new = "freq")
```

Damit haben wir schnell und dreckig - besser geht immer - die Grundlage für eine durchsuchbare Tabelle. Und für die obligatorische Wortwolke.

---

# Eine durchsuchbare Tabelle

```{r, echo = FALSE, warning = FALSE}
DT::datatable(cnt)
```

---

# Die obligatorische Wortwolke

```{r, echo = FALSE, fig.align = "center", fig.width = 11}
wordcloud2(data = cnt[1:500], size = 1.2)
```